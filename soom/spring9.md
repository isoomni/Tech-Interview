# [Tech Interview]

순환 참조는 무엇이고 어떤 상황에서 발생할까요?

 <br>

---

## 순환 참조
순환참조 문제란 A 클래스가 B 클래스의 Bean 을 주입받고, B 클래스가 A 클래스의 Bean 을 주입받는 상황처럼 서로 순환되어 참조할 경우 발생하는 문제를 의미한다.

### 왜 발생할까?
+ **필드 주입방식**과 **Setter 주입방식**에서 발생하는 순환참조문제

  + 필드 주입방식과 Setter 주입방식에서는 A 클래스가 B 클래스를 의존하고, B 클래스가 A 클래스를 의존하는 상황이더라도 애플리케이션 실행과정에서 **예외가 발생하지 않는다.**
    
  + 그리고 실제로 두 개의 클래스가 순환참조하고 있다고 하더라도 당장에 문제가 발생하지 않는다. 이러한 상황에서 문제가 되는 순간은 **A 클래스의 메소드와 B 클래스의 메소드가 서로 순환참조하고 있는 상황에서 해당 메소드가 호출되었을 때**이다.

    <br>
    
    정리)
    
    1) 스프링 애플리케이션 로딩시 예외가 발생하지 않는다.

    2) 단순히 클래스끼리 순환참조하는 것이 아니라 실제로 메소드가 순환호출되어야 하고, 해당 메소드가 호출되는 시점에 예외가 발생한다.

    -> 이건 순환참조 문제가 아니라 서로다른 메소드가 서로호출할 때 발생하는 순환호출문제이다

<br>

+ **생성자 주입 방식**에서의 순환참조 문제
    ```
  A 클래스의 Bean 을 만드는 과정에서 B 클래스의 Bean 을 주입하고, 
  없으니까 B 클래스의 Bean 을 먼저 생성한다. 
  이 때 A 클래스의 Bean 을 주입하려는데 없으니까 
  A 클래스의 Bean 을 먼저 생성한다. 
  이 때 B 클래스의 Bean 을 주입하려는데 없으니까 
  A 클래스의 Bean 을 먼저 생성.... 
  하면서 무한 반복에 빠지게된다.
  ```
  <br>

    정리)
  + 이렇게 순환되는 과정에서 결과적으로 어떠한 Bean 도 생성하지 못하는 문제를 바로 순환참조문제라고 한다.

  + 정리해보면 기억해야 할 것이 마찬가지로 두 가지이다.

  + 클래스가 서로 의존성 주입을 통해 순환참조하고 있을 때 발생하는 문제이다. (메소드까지는 가지도못함..!)
  스프링 애플리케이션 로딩시점에서 예외가 발생한다!

### 해결방안
+ 설계상 이렇게 순환참조문제가 발생할 수 있는 구조자체를 만들지 않는 것이 가장 좋다
+ 순환참조가 발생하고 있는 순환의 고리를 끊는 것이 가장 좋은 해결책이다.
+ 하지만 이렇게 순환의 고리를 끊을 수 없는 경우에는 **@Lazy 어노테이션**을 통해서 임의로 해결할 수 있다.
  + 스프링에서 권장하지 않는 방식이다.